---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { isPublished, sortByDateDesc } from '../utils/content';
import { withBase } from '../utils/paths';

const philosophy = (await getCollection('philosophy', isPublished)).sort(sortByDateDesc);
const lab = (await getCollection('lab', isPublished)).sort(sortByDateDesc);
const creative = (await getCollection('creative', isPublished)).sort(sortByDateDesc);
const comms = (await getCollection('comms', isPublished)).sort(sortByDateDesc);
const essays = [...philosophy, ...lab, ...creative, ...comms].sort(sortByDateDesc).slice(0, 6);

const practice = (await getCollection('work', isPublished)).sort(sortByDateDesc);
const featuredPractice = practice.filter((item) => item.data.featured).slice(0, 2);
const fallbackPractice = featuredPractice.length ? featuredPractice : practice.slice(0, 2);

const buckets = [
  {
    id: 'communication',
    title: 'Communication',
    description: 'Internal comms, documentation, language and power, meaning vs clarity.',
  },
  {
    id: 'cognition',
    title: 'Cognition',
    description: 'Thinking under automation, cognitive offloading, attention, judgment, skill drift.',
  },
  {
    id: 'exploration',
    title: 'Exploration',
    description: 'Open-ended inquiry, practice-led reflection, what is still forming.',
  },
  {
    id: 'philosophy',
    title: 'Philosophy',
    description: 'First principles, ethics without hype, tools, work, and meaning.',
  },
];
---
<BaseLayout title="Pruning My Pothos" description="Essays and practice through the lenses of communication, cognition, exploration, and philosophy.">
  <section class="paper-hero">
    <div>
      <p class="muted">Essays · Practice · Notes</p>
      <h1>Pruning My Pothos</h1>
      <p class="muted" style="max-width:640px;">Writing through four buckets: communication, cognition, exploration, and philosophy. “Prune often, keep what grows light, and let structure carry meaning.”</p>
      <div class="hero-actions">
        <a class="button" href={withBase('/essays')}>Read essays</a>
        <a class="button light" href={withBase('/categories')}>Browse categories</a>
      </div>
    </div>
  </section>

  <section class="section-heading">
    <h2>Latest essays</h2>
    <a href={withBase('/essays')}>View all</a>
  </section>
  <div class="listing">
    {essays.map((item) => (
      <a class="listing-item" href={withBase(`/${item.collection}/${item.slug}`)}>
        <div class="listing-meta">
          <span>{item.data.date.toLocaleDateString()}</span>
          <span class="divider"></span>
          <span class="badge">{
            item.collection === 'philosophy'
              ? 'Philosophy'
              : item.collection === 'lab' || item.collection === 'creative' || item.collection === 'comms'
                ? 'Working Note'
                : 'Essay'
          }</span>
        </div>
        <h3>{item.data.title}</h3>
        <p>{item.data.description}</p>
      </a>
    ))}
  </div>

  <section class="section-heading">
    <h2>Categories</h2>
    <a href={withBase('/categories')}>Explore</a>
  </section>
  <div class="bucket-grid">
    {buckets.map((bucket) => (
      <a class="bucket-card" href={withBase(`/categories#${bucket.id}`)}>
        <h3>{bucket.title}</h3>
        <p class="muted">{bucket.description}</p>
        <span class="text-link">Open bucket</span>
      </a>
    ))}
  </div>

  <section class="section-heading">
    <h2>Featured practice</h2>
    <a href={withBase('/practice')}>View practice</a>
  </section>
  <div class="card-grid">
    {fallbackPractice.map((item) => (
      <a class="card" href={withBase(`/practice/${item.slug}`)}>
        <h3>{item.data.title}</h3>
        <p>{item.data.problem}</p>
        <p class="muted" style="margin:0;">Outcome: {item.data.outcome}</p>
      </a>
    ))}
  </div>
</BaseLayout>
