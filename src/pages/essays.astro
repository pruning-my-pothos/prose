---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { isPublished, sortByDateDesc } from '../utils/content';
import { withBase } from '../utils/paths';

const philosophy = (await getCollection('philosophy', isPublished)).sort(sortByDateDesc);
const lab = (await getCollection('lab', isPublished)).sort(sortByDateDesc);
const creative = (await getCollection('creative', isPublished)).sort(sortByDateDesc);
const comms = (await getCollection('comms', isPublished)).sort(sortByDateDesc);
const practice = (await getCollection('work', isPublished)).sort(sortByDateDesc);

const essays = [...philosophy, ...lab, ...creative, ...comms, ...practice].sort(sortByDateDesc);
---
<BaseLayout title="Essays" description="Collected essays, working notes, and practice write-ups.">
  <div class="article">
    <h1>Essays</h1>
    <p class="muted">A single feed across philosophy, working notes, and selected practice pieces.</p>
  </div>

  <div class="listing">
    {essays.map((item) => (
      <a class="listing-item" href={withBase(`/${item.collection}/${item.slug}`)}>
        <div class="listing-meta">
          <span>{item.data.date.toLocaleDateString()}</span>
          <span class="divider"></span>
          <span class="badge">{
            item.collection === 'philosophy'
              ? 'Philosophy'
              : item.collection === 'work'
                ? 'Practice'
                : 'Working Note'
          }</span>
        </div>
        <h3>{item.data.title}</h3>
        <p>{item.data.description}</p>
      </a>
    ))}
  </div>
</BaseLayout>
