---
import ArticleLayout from '../../layouts/ArticleLayout.astro';
import { getCollection } from 'astro:content';
import { isPublished } from '../../utils/content';

export async function getStaticPaths() {
  const entries = await getCollection('work', isPublished);
  return entries.map((item) => ({
    params: { slug: item.slug },
    props: { item },
  }));
}

const { item } = Astro.props;
const { Content } = await item.render();
---
<ArticleLayout title={item.data.title} description={item.data.description}>
  <header>
    <p class="muted">Practice Â· {item.data.date.toLocaleDateString()}</p>
    <h1>{item.data.title}</h1>
    <p class="muted">{item.data.description}</p>
    <div class="meta-row" style="margin-top:0.6rem;">
      <span class="badge">Outcome: {item.data.outcome}</span>
      {item.data.tools.length ? <span>Tools: {item.data.tools.join(', ')}</span> : null}
    </div>
    <div style="margin-top:0.6rem;">
      {item.data.tags.map((tag) => (
        <span class="tag">{tag}</span>
      ))}
    </div>
  </header>

  <section>
    <h2>Problem</h2>
    <p>{item.data.problem}</p>
  </section>

  <section>
    <h2>Decisions and approach</h2>
    <p>{item.data.approach}</p>
    <Content />
  </section>

  <section>
    <h2>Outcome</h2>
    <p>{item.data.outcome}</p>
    {item.data.links.length ? (
      <div style="margin-top:0.8rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
        {item.data.links.map((link) => (
          <a class="button light" href={link.url} target="_blank" rel="noreferrer">{link.label}</a>
        ))}
      </div>
    ) : null}
  </section>
</ArticleLayout>
