---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { isPublished, sortByDateDesc } from '../../utils/content';
import { withBase } from '../../utils/paths';

const lab = (await getCollection('lab', isPublished)).sort(sortByDateDesc);
const creative = (await getCollection('creative', isPublished)).sort(sortByDateDesc);
const comms = (await getCollection('comms', isPublished)).sort(sortByDateDesc);
const notes = [...lab, ...creative, ...comms].sort(sortByDateDesc);
---
<BaseLayout title="Working Notes" description="Exploratory thinking, experiments, and drafts that seed future work.">
  <header style="max-width:720px; margin:0 0 1.5rem;">
    <h1>Working Notes</h1>
    <p class="muted">Structured explorations, not finished essays. Expect hypotheses, drafts, and directional thinking.</p>
  </header>

  <div class="listing">
    {notes.map((item) => (
      <a class="listing-item" href={withBase(`/working-notes/${item.slug}`)}>
        <div class="listing-meta">
          <span>{item.data.date.toLocaleDateString()}</span>
          <span class="divider"></span>
          <span class="badge">
            {item.collection === 'lab' ? 'Experiment' : 'Working Note'}
          </span>
        </div>
        <h3>{item.data.title}</h3>
        <p>{item.data.description}</p>
        <div>
          {item.data.tags.map((tag) => (
            <span class="tag">{tag}</span>
          ))}
        </div>
      </a>
    ))}
  </div>
</BaseLayout>
